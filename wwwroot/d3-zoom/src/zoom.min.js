/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/d3-zoom@3.0.0/src/zoom.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{dispatch}from"d3-dispatch";import{dragDisable,dragEnable}from"d3-drag";import{interpolateZoom}from"d3-interpolate";import{select,pointer}from"d3-selection";import{interrupt}from"d3-transition";import constant from"./constant.js";import ZoomEvent from"./event.js";import{Transform,identity}from"./transform.js";import noevent,{nopropagation}from"./noevent.js";function defaultFilter(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function defaultExtent(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function defaultTransform(){return this.__zoom||identity}function defaultWheelDelta(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function defaultConstrain(t,n,o){var e=t.invertX(n[0][0])-o[0][0],i=t.invertX(n[1][0])-o[1][0],r=t.invertY(n[0][1])-o[0][1],u=t.invertY(n[1][1])-o[1][1];return t.translate(i>e?(e+i)/2:Math.min(0,e)||Math.max(0,i),u>r?(r+u)/2:Math.min(0,r)||Math.max(0,u))}export default function(){var t,n,o,e=defaultFilter,i=defaultExtent,r=defaultConstrain,u=defaultWheelDelta,a=defaultTouchable,h=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],c=250,l=interpolateZoom,f=dispatch("start","zoom","end"),m=500,p=0,v=10;function d(t){t.property("__zoom",defaultTransform).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",b).on("dblclick.zoom",k).filter(a).on("touchstart.zoom",M).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",D).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,n){return(n=Math.max(h[0],Math.min(h[1],n)))===t.k?t:new Transform(n,t.x,t.y)}function z(t,n,o){var e=n[0]-o[0]*t.k,i=n[1]-o[1]*t.k;return e===t.x&&i===t.y?t:new Transform(t.k,e,i)}function g(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function _(t,n,o,e){t.on("start.zoom",(function(){T(this,arguments).event(e).start()})).on("interrupt.zoom end.zoom",(function(){T(this,arguments).event(e).end()})).tween("zoom",(function(){var t=this,r=arguments,u=T(t,r).event(e),a=i.apply(t,r),h=null==o?g(a):"function"==typeof o?o.apply(t,r):o,s=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),c=t.__zoom,f="function"==typeof n?n.apply(t,r):n,m=l(c.invert(h).concat(s/c.k),f.invert(h).concat(s/f.k));return function(t){if(1===t)t=f;else{var n=m(t),o=s/n[2];t=new Transform(o,h[0]-n[0]*o,h[1]-n[1]*o)}u.zoom(null,t)}}))}function T(t,n,o){return!o&&t.__zooming||new w(t,n)}function w(t,n){this.that=t,this.args=n,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,n),this.taps=0}function x(t,...n){if(e.apply(this,arguments)){var o=T(this,n).event(t),i=this.__zoom,a=Math.max(h[0],Math.min(h[1],i.k*Math.pow(2,u.apply(this,arguments)))),c=pointer(t);if(o.wheel)o.mouse[0][0]===c[0]&&o.mouse[0][1]===c[1]||(o.mouse[1]=i.invert(o.mouse[0]=c)),clearTimeout(o.wheel);else{if(i.k===a)return;o.mouse=[c,i.invert(c)],interrupt(this),o.start()}noevent(t),o.wheel=setTimeout(l,150),o.zoom("mouse",r(z(y(i,a),o.mouse[0],o.mouse[1]),o.extent,s))}function l(){o.wheel=null,o.end()}}function b(t,...n){if(!o&&e.apply(this,arguments)){var i=t.currentTarget,u=T(this,n,!0).event(t),a=select(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",m,!0),h=pointer(t,i),c=t.clientX,l=t.clientY;dragDisable(t.view),nopropagation(t),u.mouse=[h,this.__zoom.invert(h)],interrupt(this),u.start()}function f(t){if(noevent(t),!u.moved){var n=t.clientX-c,o=t.clientY-l;u.moved=n*n+o*o>p}u.event(t).zoom("mouse",r(z(u.that.__zoom,u.mouse[0]=pointer(t,i),u.mouse[1]),u.extent,s))}function m(t){a.on("mousemove.zoom mouseup.zoom",null),dragEnable(t.view,u.moved),noevent(t),u.event(t).end()}}function k(t,...n){if(e.apply(this,arguments)){var o=this.__zoom,u=pointer(t.changedTouches?t.changedTouches[0]:t,this),a=o.invert(u),h=o.k*(t.shiftKey?.5:2),l=r(z(y(o,h),u,a),i.apply(this,n),s);noevent(t),c>0?select(this).transition().duration(c).call(_,l,u,t):select(this).call(d.transform,l,u,t)}}function M(o,...i){if(e.apply(this,arguments)){var r,u,a,h,s=o.touches,c=s.length,l=T(this,i,o.changedTouches.length===c).event(o);for(nopropagation(o),u=0;u<c;++u)a=s[u],h=[h=pointer(a,this),this.__zoom.invert(h),a.identifier],l.touch0?l.touch1||l.touch0[2]===h[2]||(l.touch1=h,l.taps=0):(l.touch0=h,r=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),r&&(l.taps<2&&(n=h[0],t=setTimeout((function(){t=null}),m)),interrupt(this),l.start())}}function E(t,...n){if(this.__zooming){var o,e,i,u,a=T(this,n).event(t),h=t.changedTouches,c=h.length;for(noevent(t),o=0;o<c;++o)e=h[o],i=pointer(e,this),a.touch0&&a.touch0[2]===e.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===e.identifier&&(a.touch1[0]=i);if(e=a.that.__zoom,a.touch1){var l=a.touch0[0],f=a.touch0[1],m=a.touch1[0],p=a.touch1[1],v=(v=m[0]-l[0])*v+(v=m[1]-l[1])*v,d=(d=p[0]-f[0])*d+(d=p[1]-f[1])*d;e=y(e,Math.sqrt(v/d)),i=[(l[0]+m[0])/2,(l[1]+m[1])/2],u=[(f[0]+p[0])/2,(f[1]+p[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],u=a.touch0[1]}a.zoom("touch",r(z(e,i,u),a.extent,s))}}function D(t,...e){if(this.__zooming){var i,r,u=T(this,e).event(t),a=t.changedTouches,h=a.length;for(nopropagation(t),o&&clearTimeout(o),o=setTimeout((function(){o=null}),m),i=0;i<h;++i)r=a[i],u.touch0&&u.touch0[2]===r.identifier?delete u.touch0:u.touch1&&u.touch1[2]===r.identifier&&delete u.touch1;if(u.touch1&&!u.touch0&&(u.touch0=u.touch1,delete u.touch1),u.touch0)u.touch0[1]=this.__zoom.invert(u.touch0[0]);else if(u.end(),2===u.taps&&(r=pointer(r,this),Math.hypot(n[0]-r[0],n[1]-r[1])<v)){var s=select(this).on("dblclick.zoom");s&&s.apply(this,arguments)}}}return d.transform=function(t,n,o,e){var i=t.selection?t.selection():t;i.property("__zoom",defaultTransform),t!==i?_(t,n,o,e):i.interrupt().each((function(){T(this,arguments).event(e).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()}))},d.scaleBy=function(t,n,o,e){d.scaleTo(t,(function(){var t=this.__zoom.k,o="function"==typeof n?n.apply(this,arguments):n;return t*o}),o,e)},d.scaleTo=function(t,n,o,e){d.transform(t,(function(){var t=i.apply(this,arguments),e=this.__zoom,u=null==o?g(t):"function"==typeof o?o.apply(this,arguments):o,a=e.invert(u),h="function"==typeof n?n.apply(this,arguments):n;return r(z(y(e,h),u,a),t,s)}),o,e)},d.translateBy=function(t,n,o,e){d.transform(t,(function(){return r(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof o?o.apply(this,arguments):o),i.apply(this,arguments),s)}),null,e)},d.translateTo=function(t,n,o,e,u){d.transform(t,(function(){var t=i.apply(this,arguments),u=this.__zoom,a=null==e?g(t):"function"==typeof e?e.apply(this,arguments):e;return r(identity.translate(a[0],a[1]).scale(u.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof o?-o.apply(this,arguments):-o),t,s)}),e,u)},w.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var n=select(this.that).datum();f.call(t,this.that,new ZoomEvent(t,{sourceEvent:this.sourceEvent,target:d,type:t,transform:this.that.__zoom,dispatch:f}),n)}},d.wheelDelta=function(t){return arguments.length?(u="function"==typeof t?t:constant(+t),d):u},d.filter=function(t){return arguments.length?(e="function"==typeof t?t:constant(!!t),d):e},d.touchable=function(t){return arguments.length?(a="function"==typeof t?t:constant(!!t),d):a},d.extent=function(t){return arguments.length?(i="function"==typeof t?t:constant([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),d):i},d.scaleExtent=function(t){return arguments.length?(h[0]=+t[0],h[1]=+t[1],d):[h[0],h[1]]},d.translateExtent=function(t){return arguments.length?(s[0][0]=+t[0][0],s[1][0]=+t[1][0],s[0][1]=+t[0][1],s[1][1]=+t[1][1],d):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},d.constrain=function(t){return arguments.length?(r=t,d):r},d.duration=function(t){return arguments.length?(c=+t,d):c},d.interpolate=function(t){return arguments.length?(l=t,d):l},d.on=function(){var t=f.on.apply(f,arguments);return t===f?d:t},d.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,d):Math.sqrt(p)},d.tapDistance=function(t){return arguments.length?(v=+t,d):v},d}
//# sourceMappingURL=/sm/9c199ab17ec88ef381a45c2a856f1bdcbe5fc68362c923415fbb6d987c8b9046.map